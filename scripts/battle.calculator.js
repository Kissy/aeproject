var f=[[5,1,2,2,0],[10,2,4,2,0],[30,3,10,4,0],[60,5,12,4,1],[20,1,4,4,0],[30,1,2,2,0],[40,3,8,8,0],[80,2,12,12,0],[120,5,14,12,1],[40,1,1,2,0],[100,1,2,4,0],[200,3,24,24,2],[400,2,12,24,2],[500,3,48,48,4],[2E3,5,168,128,10],[2500,5,64,96,8],[1E4,6,756,512,20],[5E4,7,3402,2048,30],[2E5,6,1E4,6600,40],[5E5,7,25500,13500,60],[0,1,4,4,0],[0,1,8,8,0],[0,2,16,16,0],[0,3,24,24,0],[0,5,32,32,2],[0,6,64,64,6],[0,7,256,256,8],[0,5,2,512,16],[0,5,4,2048,20],[0,6,2048,1024,12]],i={Fighters:0,Bombers:1,"Heavy Bombers":2,
"Ion Bombers":3,Corvette:4,Recycler:5,Destroyer:6,Frigate:7,"Ion Frigate":8,"Scout Ship":9,"Outpost Ship":10,Cruiser:11,Carrier:12,"Heavy Cruiser":13,Battleship:14,"Fleet Carrier":15,Dreadnought:16,Titan:17,Leviathan:18,"Death Star":19,Barracks:20,"Laser Turrets":21,"Missile Turrets":22,"Plasma Turrets":23,"Ion Turrets":24,"Photon Turrets":25,"Disruptor Turrets":26,"Deflection Shields":27,"Planetary Shield":28,"Planetary Ring":29},k={armour:0,laser:1,missiles:2,plasma:3,shielding:4,ion:5,photon:6,
disruptor:7},m=0,n=f.length,o=Array(n),p=/^[0-9]*.?[0-9]+$/,q=/^\d*$/;function r(b){var c,a,g,d=0,e=0;for(c=c=0;c<n;c++){a=$("#qt_"+b+c).val();g=$("#rs_"+b+c).html();if(a!=0&&f[c][0])d+=Math.round(a-Math.ceil(g))*f[c][0];if(b==1&&a!=0)e+=(a-g)*f[c][0]*0.5}c=Math.round(d*$("#l_"+b+"0").val()*0.02);e=Math.round(e);return[d,c,e]}
function s(b,c){var a,g,d,e=parseFloat($("#qt_1"+b).val()),j=parseFloat($("#pw_1"+b).html()),h=Array(n);if(e!=0){for(a=0;a<n;a++)if($("#qt_2"+a).val()!=0){d=$("#sh_2"+a);h[a]=d[0]?d.val()>j?j*c:j-d.val()*(1-c):j}else h[a]=0;d=e;for(e=0;e<4;e++)if(m>0){m=0;j=Array(n);var l=0;for(a=0;a<n;a++)l+=h[a];for(a=0;a<n;a++){j[a]=0;if(h[a]!=0||$("#qt_2"+b).val()!=0)j[a]=b<20||e==0?h[a]*d/l:d/g;o[a]-=j[a]*h[a];m+=o[a]}l=Array(n);for(a=0;a<n;a++)l[a]=o[a]<0?(h[a]*j[a]+o[a])/h[a]:j[a];for(a=m=g=0;a<n;a++){d-=l[a];
o[a]>0&&g++;if(o[a]<0){h[a]=0;l[a]=0;o[a]=0}m+=o[a]}}}else for(a=0;a<=n;a++)h[a]=0}
function t(b,c){var a,g,d,e=parseFloat($("#qt_2"+b).val()),j=parseFloat($("#pw_2"+b).val()),h=Array(n);if(e!=0){for(a=0;a<n;a++)if($("#qt_1"+a).val()!=0){d=$("#sh_1"+a).html();h[a]=d!=0?d>j?j*c:j-d*(1-c):j}else h[a]=0;d=e;for(e=0;e<4;e++)if(m>0){m=0;j=Array(n);var l=0;for(a=0;a<n;a++)l+=h[a];for(a=0;a<n;a++){j[a]=0;if(h[a]!=0||$("#qt_1"+b).val()!=0)j[a]=b<20||e==0?h[a]*d/l:d/g;o[a]-=j[a]*h[a];m+=o[a]}l=Array(n);for(a=0;a<n;a++)l[a]=o[a]<0?(h[a]*j[a]+o[a])/h[a]:j[a];for(a=m=g=0;a<n;a++){d-=l[a];o[a]>
0&&g++;if(o[a]<0){h[a]=0;l[a]=0;o[a]=0}m+=o[a]}}}else for(a=0;a<=n;a++)h[a]=0}
function u(){var b;for(b=m=0;b<n;b++){o[b]=$("#qt_1"+b).val()*$("#ar_1"+b).html();m+=o[b]}for(b=0;b<n;b++)b==3||b==8?t(b,0.5):t(b,0.01);for(var c=0;c<n;c++){var a;a=c>13?100:c>10?10:1;b=$("#rs_1"+c);b.html(String(Math.round(o[c]/$("#ar_1"+c).html()*a)/a));if($("#qt_1"+c).val()!=0)b.html()==0?b.css("color","red"):b.css("color","white");else b.css("color","#0D141A")}for(b=m=0;b<n;b++){o[b]=$("#qt_2"+b).val()*$("#ar_2"+b).val();m+=o[b]}for(b=0;b<n;b++)b==3||b==8?s(b,0.5):s(b,0.01);for(c=0;c<n;c++){a=
c>13?100:c>10?10:1;b=$("#rs_2"+c);b.html(String(Math.round(o[c]/$("#ar_2"+c).val()*a)/a));if($("#qt_2"+c).val()!=0)b.html()==0?b.css("color","red"):b.css("color","white");else b.css("color","#0D141A")}b=r(1);$("#loss_1").html(b[0]);c=r(2);$("#loss_2").html(c[0]);$("#debris").html(b[1]+c[1]);$("#repair").html(b[2]);$("#totald").html(b[0]+c[0]);c[0]!=0?$("#ratio").html(String(Math.round(100*b[0]/c[0])/100)):$("#ratio").html("-")}
function v(){for(var b=$("#qt_119").val()!=0?1.1:$("#qt_118").val()!=0?1.05:1,c,a,g,d=0;d<n;d++){if(d<20){c=1+parseInt($("#b_18").html(),10)*0.01;a=1;g=1+parseInt($("#b_110").html(),10)*0.01}else{c=1;a=1+parseInt($("#b_19").html(),10)*0.01;g=1}a=b*a*10;$("#pw_1"+d).html(String(Math.round(a*f[d][2]*g*c*(1+parseInt($("#b_1"+f[d][1]).html(),10)*0.01)*10)/100));$("#ar_1"+d).html(String(Math.round(a*f[d][3]*(1+parseInt($("#b_10").html(),10)*0.01))/10));c=f[d][4];$("#sh_1"+d).html(String(Math.round(c*(1+
0.01*$("#b_14").html())*10)/10));c==0&&$("#sh_1"+d).css("color","#0D141A")}}
function w(){for(var b=$("#qt_219").val()!=0?1.1:$("#qt_218").val()!=0?1.05:1,c,a,g,d=0;d<n;d++){if(d<20){c=1+parseInt($("#b_28").html(),10)*0.01;a=1;g=1+parseInt($("#b_210").html(),10)*0.01}else{c=1;a=1+parseInt($("#b_29").html(),10)*0.01;g=1}$("#pw_2"+d).val(String(Math.round(f[d][2]*b*g*a*c*(1+parseInt($("#b_2"+f[d][1]).html(),10)*0.01)*100)/100));$("#ar_2"+d).val(String(Math.round(f[d][3]*b*a*(1+parseInt($("#b_20").html(),10)*0.01)*10)/10));c=f[d][4];$("#sh_2"+d)&&$("#sh_2"+d).val(String(Math.round(c*
(1+0.01*$("#b_24").html())*10)/10))}}function x(b){for(var c=0;c<9;c++)$("#b_"+b+c).html(String(5*$("#l_"+b+c).val()));$("#b_"+b+"9").html($("#l_"+b+"9").val().toString());$("#b_"+b+"10").html($("#l_"+b+"10").val().toString())}
function y(){var b;$(".qt_1,.qt_2,.tech_1,.tech_2,.pw_2,.ar_2,.sh_2").each(function(){$(this).val("0");if($(this).hasClass("qt_1")||$(this).hasClass("qt_2"))$(this).css("color","#40525A")});var c=$("#pastDataInput").val().split("\n"),a=0,g=0,d;for(d=0;d<c.length;d++){c[d]=="Attack Force"&&a++;c[d]=="Defensive Force"&&g++;if(a==1&&g==0&&c[d].indexOf("Commander",0)!=-1)if(c[d].indexOf("Defense",0)!=-1)$("#l_19").val(c[d].substring(c[d].indexOf("(Defense ",0)+9,c[d].length-1));else c[d].indexOf("Tactical",
0)!=-1&&$("#l_110").val(c[d].substring(c[d].indexOf("(Tactical ",0)+10,c[d].length-1));else if(a==1&&g==1&&c[d].indexOf("Command Centers",0)!=-1)$("#l_28").val(c[d].substring(16,c[d].length));else if(a==1&&g==1&&c[d].indexOf("Commander",0)!=-1)if(c[d].indexOf("Defense",0)!=-1)$("#l_29").val(c[d].substring(c[d].indexOf("(Defense ",0)+9,c[d].length-1));else c[d].indexOf("Tactical",0)!=-1&&$("#l_210").val(c[d].substring(c[d].indexOf("(Tactical ",0)+10,c[d].length-1));else if(a==2&&g==1){b=c[d].substring(0,
c[d].indexOf("\t",0));var e=i[b];if(e!=null){b=c[d].split("\t");$("#qt_1"+e).val(b[1]);$("#qt_1"+e).css("color","white");$("#pw_1"+e).html(b[3]);$("#ar_1"+e).html(b[4]);$("#sh_1"+e).html(b[5]);var j,h,l;if(e<20){j=1+parseInt($("#b_18").html(),10)*0.01;h=0;l=parseInt($("#b_110").html(),10)}else{j=1;h=parseInt($("#b_19").html(),10);l=0}$("#l_1"+f[e][1]).val()==0&&$("#l_1"+f[e][1]).val(Math.round((b[3]*j-f[e][2]*(1-l-h))*20/f[e][2]).toString());$("#l_10").val()==0&&$("#l_10").val(Math.round((b[4]-f[e][3]*
(1-h))*20/f[e][3]).toString());$("#l_14").val()==0&&b[5]!=0&&$("#l_14").val(Math.round((b[5]-f[e][4])*20/f[e][4]).toString())}}else if(a==2&&g==2){b=c[d].substring(0,c[d].indexOf("\t",0));e=i[b];if(e!=null){b=c[d].split("\t");$("#qt_2"+e).val(b[1]);$("#qt_2"+e).css("color","white");$("#pw_2"+e).val(b[3]);$("#ar_2"+e).val(b[4]);$("#sh_2"+e).val(b[5]);if(e<20){j=1+parseInt($("#l_28").val(),10)*0.05;h=0;l=parseInt($("#l_210").val(),10)/5}else{j=1;h=parseInt($("#l_29").val(),10)/5;l=0}var z=$("#qt_219").val()!=
0?1.1:$("#qt_218").val()!=0?1.05:1;$("#l_2"+f[e][1]).val()==0&&$("#l_2"+f[e][1]).val(Math.round((b[3]/z/j/f[e][3]-1)*20-h-l).toString());$("#l_20").val()==0&&$("#l_20").val(Math.round((b[4]-f[e][3])*20/f[e][3]).toString());$("#l_24").val()==0&&b[5]!=0&&$("#l_24").val(Math.round((b[5]-f[e][4])*20/f[e][4]).toString())}}}}
function A(){$(".qt_1,.qt_2,.tech_1,.tech_2,.pw_2,.ar_2,.sh_2").each(function(){p.test($(this).val())||$(this).val("0");$(this).val()!=0&&$(this).css("color","white")});x(1);v();x(2);w()}
function B(){$("#resetATKTech").bind("click",function(){$(".tech_1").each(function(){$(this).val("0")});x(1);v();u()});$("#resetDEFTech").bind("click",function(){$(".tech_2").each(function(){$(this).val("0")});x(2);w();u()});$("#resetATKFleet").bind("click",function(){$(".qt_1").each(function(){$(this).val("0");$(this).css("color","#40525A")});u()});$("#resetDEFFleet").bind("click",function(){$(".qt_2").each(function(){$(this).val("0");$(this).css("color","#40525A")});u()});$("#resetAll").bind("click",
function(){$("input").each(function(){$(this).val("0");if($(this).hasClass("qt_1")||$(this).hasClass("qt_2"))$(this).css("color","#40525A")});x(1);v();x(2);w();u()});$("#pastData,#seekTech").overlay({mask:{color:"#222222",opacity:"0.8"}});$("#pastDataSubmit").bind("click",function(){y();x(1);v();x(2);w();u();$("#pastDataInput").val("");$("#pastData").data("overlay").close()});$("#seekTechForm").bind("submit",function(){var b=$("#seekTechInput").val();if(b=="")return false;$("#seekTechInput").val("-- Searching --");
$("#seekTechInput,#seekTechSubmit").attr("disabled","disabled");$.getJSON("/technologies/seek","player_id="+b,function(c){if(c)for(var a in c.Technology)$("#l_2"+k[a]).val(c.Technology[a]);else $(".tech_2").val("0")});x(2);w();u();$("#seekTechInput").val("");$("#seekTech").data("overlay").close();$("#seekTechInput,#seekTechSubmit").removeAttr("disabled");return false});$("#previousRound").bind("click",function(){var b=$("#history").val().split("#"),c=b.pop().split("&");c.length==60&&$(".qt_1,.qt_2").each(function(a){$(this).val(c[a]);
$(this).val()==0?$(this).css("color","#40525A"):$(this).css("color","white")});$("#history").val(b.join("#"));u()});$("#nextRound").bind("click",function(){var b=$("#history").val().split("#"),c=[];$(".qt_1,.qt_2").each(function(){c.push($(this).val())});b.push(c.join("&"));$("#history").val(b.join("#"));$(".qt_1").each(function(a){$(this).val($("#rs_1"+a).html().toString());$(this).val()==0&&$(this).css("color","#40525A")});$(".qt_2").each(function(a){$(this).val($("#rs_2"+a).html().toString());
$(this).val()==0&&$(this).css("color","#40525A")});u()})}
$(document).ready(function(){B();A();u();$(".qt_1").bind("change",function(){p.test($(this).val())||$(this).val("0");$(this).val()!=0?$(this).css("color","white"):$(this).css("color","#40525A");if($(this).attr("name")==18||$(this).attr("name")==19)v();u()});$(".qt_2").bind("change",function(){p.test($(this).val())||$(this).val("0");$(this).val()!=0?$(this).css("color","white"):$(this).css("color","#40525A");if($(this).attr("name")==18||$(this).attr("name")==19)w();u()});$(".tech_1").bind("change",
function(){q.test($(this).val())||$(this).val("0");$("#b_1"+$(this).attr("name")).html(String(5*$(this).val()));v();u()});$(".tech_2").bind("change",function(){q.test($(this).val())||$(this).val("0");$("#b_2"+$(this).attr("name")).html(String(5*$(this).val()));w();u()});$(".cmd_1").bind("change",function(){q.test($(this).val())||$(this).val("0");$("#b_1"+$(this).attr("name")).html($(this).val().toString());v();u()});$(".cmd_2").bind("change",function(){q.test($(this).val())||$(this).val("0");$("#b_2"+
$(this).attr("name")).html($(this).val().toString());w();u()});$(".pw_2").bind("change",function(){var b,c,a,g=$(this).attr("name");if(g<20){b=1+parseInt($("#b_28").html(),10)*0.01;c=0;a=parseInt($("#l_210").val(),10)/5}else{b=1;c=parseInt($("#l_29").val(),10)/5;a=0}var d=$("#qt_219").val()!=0?1.1:$("#qt_218").val()!=0?1.05:1;$(this).val()<f[g][2]*d*b*Math.round(10*(1+a/20))/10*Math.round(10*(1+c/20))/10&&$(this).val(String(f[g][2]*d*b*Math.round(10*(1+a/20))/10*Math.round(10*(1+c/20))/10));$("#l_2"+
f[g][1]).val(Math.round(($(this).val()/d/b/f[g][2]-1)*20-c-a).toString());x(2);w();u()});$(".ar_2").bind("change",function(){var b=$(this).attr("name"),c=$("#qt_219").val()!=0?1.1:$("#qt_218").val()!=0?1.05:1;$(this).val()<f[b][3]*c&&$(this).val(String(f[b][3]*c));$("#l_20").val(Math.round(($(this).val()/c/f[b][3]-1)*20).toString());x(2);w();u()});$(".sh_2").bind("change",function(){var b=$(this).attr("name");$(this).val()<f[b][4]&&$(this).val(f[b][4]);$("#l_24").val(Math.round(($(this).val()/f[b][4]-
1)*20).toString());x(2);w();u()})});
